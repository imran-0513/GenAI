
########## sql llm app
https://github.com/krishnaik06/Google-Gemini-Crash-Course/blob/main/sqlllm/sqlite.py

https://github.com/krishnaik06/Invoice-Extractor-LLM-APP

##########




app.py

from dotenv import load_dotenv

load_dotenv() ### load all the environments

import streamlit as st
import os
import sqlite3
import google.generativeai as genai


### configure our api key
genai.configure(api_key=os.getenv("GOOGLE_API_KEY"))


### function to load google gemini model and provide query as response

def get_gemini_response(question,prompt):
    model = genai.GenerativeModel('gemini-pro')
    response = model.generate_content([prompt,question])
    return response.text


### function to retrieve query to sql database

def read_sql_query(sql,db):
    conn = sqlite3.connect(db)
    cur = conn.cursor()
    cur.execute(sql)
    rows = cur.fetchall()
    conn.commit()
    conn.close()
    for row in rows:
        print(row)

    return rows



######### define your prompt

prompt=[
    """
    You are an expert in converting English questions to SQL query!
    The SQL database has the name STUDENT and has the following columns - NAME, CLASS, 
    SECTION \n\nFor example,\nExample 1 - How many entries of records are present?, 
    the SQL command will be something like this SELECT COUNT(*) FROM STUDENT ;
    \nExample 2 - Tell me all the students studying in Data Science class?, 
    the SQL command will be something like this SELECT * FROM STUDENT 
    where CLASS="Data Science"; 
    also the sql code should not have ``` in beginning or end and sql word in output

    """
]


### streamlit app

st.set_page_config(page_title="I can Retrieve Any SQL query")
st.header("Gemini App To Retrieve SQL Data")

question=st.text_input("Input: ",key="input")

submit=st.button("Ask the question")

# if submit is clicked
if submit:
    response=get_gemini_response(question,prompt)
    print(response)
    data=read_sql_query(response,"student.db")
    st.subheader("The REsponse is")
    for row in data:
        print(row)
        st.header(row)




sql.py
import sqlite3

### connect to sqlite3
connection = sqlite3.connect("student.db")

### create a curson object to insert,record, create table, retrieve

cursor = connection.cursor()

### create a table

table_info = """
        create table student(name varchar(25),class varchar(25),
        section varchar(25),marks int);

"""

cursor.execute(table_info)

### insert some more records

cursor.execute('''Insert Into STUDENT values('Krish','Data Science','A',90)''')
cursor.execute('''Insert Into STUDENT values('Sudhanshu','Data Science','B',100)''')
cursor.execute('''Insert Into STUDENT values('Darius','Data Science','A',86)''')
cursor.execute('''Insert Into STUDENT values('Vikash','DEVOPS','A',50)''')
cursor.execute('''Insert Into STUDENT values('Dipesh','DEVOPS','A',35)''')


#### display all the records

print("the inserted records are ")

data = cursor.execute('''select * from student''')

for row in data:
    print(row)


### close the connection
connection.commit()
connection.close()

getting below error

TypeError: Could not create `Blob`, expected `Blob`, `dict` or an `Image` type(`PIL.Image.Image` or `IPython.display.Image`). Got a: <class 'list'> Value: ['\n You are an expert in converting English questions to SQL query!\n The SQL database has the name STUDENT and has the following columns - NAME, CLASS, \n SECTION \n\nFor example,\nExample 1 - How many entries of records are present?, \n the SQL command will be something like this SELECT COUNT(*) FROM STUDENT ;\n \nExample 2 - Tell me all the students studying in Data Science class?, \n the SQL command will be something like this SELECT * FROM STUDENT \n where CLASS="Data Science"; \n also the sql code should not have ``` in beginning or end and sql word in output\n\n ']
Traceback:
